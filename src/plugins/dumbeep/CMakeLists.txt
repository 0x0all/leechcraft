CMAKE_MINIMUM_REQUIRED (VERSION 2.8)
PROJECT (leechcraft_dumbeep)
INCLUDE (InitLCPlugin OPTIONAL)

OPTION (DUMBEEP_WITH_PHONON "Build with support for Phonon backend" OFF)

IF (DUMBEEP_WITH_PHONON)
	SET (CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake;${CMAKE_MODULE_PATH}")

	IF (NOT WIN32)
		FIND_PACKAGE (Phonon)
	ENDIF (NOT WIN32)

	IF (WIN32)
		MESSAGE (STATUS "Using Qt's Phonon on Windows")
		SET (QT_USE_PHONON TRUE)
	ELSE (WIN32)
		IF (NOT PHONON_FOUND)
			MESSAGE (WARNING "KDE Phonon not found, trying Qt's one instead...")
			SET (QT_USE_PHONON TRUE)
		ELSE (NOT PHONON_FOUND)
			MESSAGE (STATUS "Found KDE Phonon! Woohoo!")
			SET (QT_PHONON_INCLUDES ${PHONON_INCLUDES})
			SET (QT_PHONON_LIBS ${PHONON_LIBS})
			ADD_DEFINITIONS (-DHAVE_KDE_PHONON)
		ENDIF (NOT PHONON_FOUND)
	ENDIF (WIN32)

	ADD_DEFINITIONS (-DWITH_PHONON)
ENDIF (DUMBEEP_WITH_PHONON)

INCLUDE (${QT_USE_FILE})
INCLUDE_DIRECTORIES (
	${CMAKE_CURRENT_BINARY_DIR}
	${Boost_INCLUDE_DIR}
	${LEECHCRAFT_INCLUDE_DIR}
	)
SET (SRCS
	dumbeep.cpp
	xmlsettingsmanager.cpp
	)

ADD_LIBRARY (leechcraft_dumbeep SHARED
	${COMPILED_TRANSLATIONS}
	${SRCS}
	)
TARGET_LINK_LIBRARIES (leechcraft_dumbeep
	${QT_LIBRARIES}
	${LEECHCRAFT_LIBRARIES}
	${QT_PHONON_LIBS}
	)
INSTALL (TARGETS leechcraft_dumbeep DESTINATION ${LC_PLUGINS_DEST})
INSTALL (FILES dumbeepsettings.xml DESTINATION ${LC_SETTINGS_DEST})
