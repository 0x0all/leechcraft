<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?include defines.wxi?>
    <Product Id="$(var.ProductCode)" Name="$(var.ProductName)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="$(var.Manufacturer)" UpgradeCode="$(var.UpgradeCode)" >
      <Package Id="*" Keywords="Installer" Description="Leechcraft $(var.ProductTextVersion) Installer" Manufacturer="$(var.Manufacturer)" InstallerVersion="301" Compressed="yes" InstallScope="perMachine" InstallPrivileges="elevated"/>
      
      <Media Id="1" Cabinet="leechcraft.cab" EmbedCab="yes" />
      <Media Id="2" Cabinet="qt.cab" EmbedCab="yes" />

      <MajorUpgrade DowngradeErrorMessage="A newer version of $(var.ProductName) is already installed." AllowSameVersionUpgrades="yes" MigrateFeatures="yes" Schedule="afterInstallInitialize"/>
   
      <Directory Id="TARGETDIR" Name="SourceDir">
        <Directory Id="DesktopFolder" Name="Desktop">
          <Component Id="ApplicationShortcutDesktop" Guid="{BCBEDFAF-5881-45D6-9FDE-91F60E58ADB2}">
            <Shortcut Id="ApplicationDesktopShortcut" Name="LeechCraft" Description="Launch LeechCraft" Target="[INSTALLFOLDER]leechcraft.exe" WorkingDirectory="INSTALLFOLDER" />
            <RemoveFolder Id="DesktopFolder" On="uninstall" />
            <RegistryValue Root="HKCU" Key="Software/$(var.Manufacturer)/$(var.ProductName)" Name="installed" Type="integer" Value="1" KeyPath="yes" />
          </Component>
        </Directory>
        <Directory Id="ProgramFilesFolder">
            <Directory Id="DIR_Deviant" Name="$(var.Manufacturer)">
                <Directory Id="INSTALLFOLDER" Name="$(var.ProductName)">
                    <Directory Id="DIR_icons" Name="icons" />
                    <Directory Id="DIR_include" Name="include" />
                    <Directory Id="DIR_themes" Name="leechcraft" />
                    <Directory Id="DIR_plugins" Name="plugins">
                      <Directory Id="DIR_leechcraft_plugins" Name="bin" />
                      <Directory Id="DIR_imageformats" Name="imageformats" />
                      <Directory Id="DIR_sqldrivers" Name="sqldrivers" />
                    </Directory>
                    <Directory Id="DIR_settings" Name="settings" />
                    <Directory Id="DIR_share" Name="share" />
                    <Directory Id="DIR_translations" Name="translations" />
                </Directory>
            </Directory>
        </Directory>
      </Directory>
      
      <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
      <WixVariable Id="WixUILicenseRtf" Value="license.rtf" />
      <WixVariable Id="WixUIDialogBmp" Value="installscreen.bmp" />
      <WixVariable Id="WixUIBannerBmp" Value="headerimage.bmp" />

      <Icon Id="AppIcon" SourceFile="$(var.SourcePath)\leechcraft.ico"/>
      <Property Id="ARPPRODUCTICON" Value="AppIcon" />
      <UI>
        <UIRef Id="WixUI_Mondo" />
      </UI>

      <Feature Id="Feature_Core" Title="Core" Level="1" Absent="disallow">
        <Feature Id="Feature_LeechCraft" Title="LeechCraft" Absent="disallow" Description="LeechCraft's core">
          <ComponentGroupRef Id="CG_CoreBinaries" />
          <ComponentGroupRef Id="CG_LeechCraftCoreLibraries" />
          <ComponentGroupRef Id="CG_LeechCraftInclude" />
          <ComponentGroupRef Id="CG_LeechCraftShare" />
          <ComponentGroupRef Id="CG_LeechCraftSettings" />
          <ComponentRef Id="ApplicationShortcutDesktop"/>
        </Feature>
        <Feature Id="Feature_Qt" Title="Qt" Absent="disallow" Description="Qt libraries" >
          <ComponentGroupRef Id="CG_QtLibs" />
          <ComponentGroupRef Id="CG_QtPlugins" />
        </Feature>
        <Feature Id="Feature_OpenSSL" Title="OpenSSL" Absent="disallow" Description="OpenSSL libraries" >
          <ComponentGroupRef Id="CG_OpenSSLLibraries" />
        </Feature>
        <Feature Id="Feature_Icons" Title="Icons" Absent="disallow" Description="Icons" >
          <ComponentGroupRef Id="CG_LeechCraftIcons" />
          <ComponentGroupRef Id="CG_LeechCraftThemes" />
        </Feature>
        <Feature Id="Feature_Translations" Title="Translations" Absent="disallow" Description="Translations">
          <ComponentGroupRef Id="CG_LeechCraftTranslations" />
        </Feature>
      </Feature>
      <Feature Id="Feature_Plugins" Title="Plugins" Level="1" Absent="allow" Description="LeechCraft plugins">
          <FeatureRef Id="Feature_advancednotifications" />
          <FeatureRef Id="Feature_cstp" />
          <FeatureRef Id="Feature_aggregator" />
          <FeatureRef Id="Feature_auscrie" />
          <FeatureRef Id="Feature_azoth" />
          <FeatureRef Id="Feature_bittorrent" />
          <FeatureRef Id="Feature_blasq" />
          <FeatureRef Id="Feature_blogique" />
          <FeatureRef Id="Feature_deadlyrics" />
          <FeatureRef Id="Feature_dlniwe" />
          <FeatureRef Id="Feature_dolozhee" />
          <FeatureRef Id="Feature_gacts" />
          <FeatureRef Id="Feature_glance" />
          <FeatureRef Id="Feature_gmailnotifier" />
          <FeatureRef Id="Feature_harbinger" />
          <FeatureRef Id="Feature_historyholder" />
          <FeatureRef Id="Feature_hotstreams" />
          <FeatureRef Id="Feature_imgaste" />
          <FeatureRef Id="Feature_kinotify" />
          <FeatureRef Id="Feature_knowhow" />
          <FeatureRef Id="Feature_lackman" />
          <FeatureRef Id="Feature_lastfmscrobble" />
          <FeatureRef Id="Feature_lhtr" />
          <FeatureRef Id="Feature_liznoo" />
          <FeatureRef Id="Feature_lmp" />
          <FeatureRef Id="Feature_monocle" />
          <FeatureRef Id="Feature_musiczombie" />
          <FeatureRef Id="Feature_nacheku" />
          <FeatureRef Id="Feature_netstoremanager" />
          <FeatureRef Id="Feature_networkmonitor" />
          <FeatureRef Id="Feature_newlife" />
          <FeatureRef Id="Feature_pintab" />
          <FeatureRef Id="Feature_pogooglue" />
          <FeatureRef Id="Feature_poleemery" />
          <FeatureRef Id="Feature_poshuku" />
          <FeatureRef Id="Feature_sb2" />
          <FeatureRef Id="Feature_secman" />
          <FeatureRef Id="Feature_seekthru" />
          <FeatureRef Id="Feature_summary" />
          <FeatureRef Id="Feature_tabslist" />
          <FeatureRef Id="Feature_tabsessmanager" />
          <FeatureRef Id="Feature_touchstreams" />
          <FeatureRef Id="Feature_tpi" />
          <FeatureRef Id="Feature_vgrabber" />
          <FeatureRef Id="Feature_vrooby" />
          <FeatureRef Id="Feature_woodpecker" />
          <FeatureRef Id="Feature_xproxy" />
          <FeatureRef Id="Feature_xtazy" />

        <ComponentGroupRef Id="CG_CommonLibs" />
      </Feature>
    </Product>

    <Fragment>
      <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
          <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
          <!-- <Component Id="ProductComponent"> -->
          <!-- TODO: Insert files, registry keys, and other resources here. -->
          <!-- </Component> -->
      </ComponentGroup>
    </Fragment>
</Wix>